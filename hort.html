<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <title>hort</title>
  <link rel="stylesheet" href="styles_hort.css">
</head>
<body>
  <nav>   
    <ul>
      <li><a href="index.html">Inici</a></li>
      <li><a href="hort.html">Hort</a></li>
      <li><a href="tecnologia.html">Tecnologia</a></li>
      <li><a href="castella.html">Castellà</a></li>
      <li><a href="angles.html">Anglès</a></li>
      <li><a href="catala.html">Català</a></li>
      <li><a href="biologia.html">Biologia</a></li>
      <li><a href="frances.html">Francès</a></li>
    </ul>
  </nav>
  <main>
    <h1>Tecnologia</h1>
    <p class="description">
    Per mostrar aquestes dades, he utilitzat una placa ESP32 equipada amb sensors ambientals. Mitjançant ArduinoBlocks he programat la lectura de temperatura i llum, i la seva transmissió mitjançant WiFi. Aquestes dades s'envien a Google Sheets i es mostren aquí a la web.
    </p>
    <div class="sensor-box">
      <h2>Dades de l'hort</h2>
      <p>Temperatura: <span id="temp">--</span> ºC</p>
      <p>Humitat: <span id="humitat">--</span> %</p>
      <p>Llum: <span id="llum">--</span></p>
      <p>Humitat Terra: <span id="terra">--</span> %</p>
      <p>CO₂: <span id="co2">--</span> ppm</p>
      <p>Hora: <span id="hora">--</span></p>
    </div>

    <div class="sensor-box">
      <h2>Control del robot (en local)</h2>
      <button onclick="enviarOrdre('led_on')">Encén el LED</button>
      <button onclick="enviarOrdre('led_off')">Apaga el LED</button>
      <button onclick="enviarOrdre('servo_dreta')">Gira servo dreta</button>
      <button onclick="enviarOrdre('servo_esquerra')">Gira servo esquerra</button>
    </div>
  </main>

  <script>
    // URL del teu Google Apps Script (canvia-la per la teva real)
    const urlDadesGoogle = "https://script.google.com/macros/s/AKfycbw-eaBqUf2L685tpzcTxVvdJ66Nn7ZJZemlLbfCl_jeU4-nexx-qGMZVd_Ytv-FioUrYA/exec";

    function carregarDades() {
      fetch(urlDadesGoogle)
        .then(res => res.json())
        .then(data => {
          document.getElementById("temp").innerText = data.T;
          document.getElementById("humitat").innerText = data.H;
          document.getElementById("llum").innerText = data.Ll;
          document.getElementById("terra").innerText = data["H-t"];
          document.getElementById("co2").innerText = data.co2;
          document.getElementById("hora").innerText = data.Hora;
        })
        .catch(err => console.error("Error en carregar dades de Google:", err));
    }

    // Carrega dades cada 5 segons
    setInterval(carregarDades, 5000);
    carregarDades();

    // Mantinc la part de control per l'ESP32 local
    const ipRobot = "http://192.168.1.123";

    function enviarOrdre(ordre) {
      fetch(ipRobot + "/actua?ordre=" + ordre)
        .then(() => console.log("Ordre enviada:", ordre))
        .catch(err => console.error("Error en enviar ordre:", err));
    }
  </script>
</body>
</html>
